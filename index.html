<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>南陵祭 モバイルオーダー</title>
    <style>
      /* 
         * CSSセクション: ページの見た目を整えるスタイル定義
         */

      /* ページ全体の基本スタイル */
      body {
        font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN",
          "Hiragino Sans", Meiryo, sans-serif;
        max-width: 800px; /* コンテンツの最大幅を制限 */
        margin: 0 auto; /* 左右中央寄せ */
        padding: 20px; /* ページ周囲の余白 */
        background-color: #f9f9f9; /* 薄いグレーの背景 */
        color: #333; /* 文字色 */
      }

      /* 大見出しのスタイル */
      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
      }

      /* セクション見出しのスタイル */
      h2 {
        border-bottom: 2px solid #e74c3c; /* 下線を追加 */
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      /* 店舗リストを表示するコンテナのスタイル */
      #store-list {
        display: flex;
        flex-direction: column;
        gap: 15px; /* アイテム間の間隔 */
      }

      /* 各店舗情報のカードスタイル (.store-item) */
      .store-item {
        background-color: #fff;
        border: 1px solid #ddd; /* 薄い枠線 */
        border-radius: 8px; /* 角丸 */
        padding: 20px; /* 内側の余白 */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* 軽い影をつける */
        transition: transform 0.2s; /* ホバー時のアニメーション用 */
      }

      /* ホバー時に少し浮き上がる演出 */
      .store-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* 店舗名のスタイル (.store-name) */
      .store-name {
        font-size: 1.4em; /* フォントサイズを大きく */
        font-weight: bold;
        color: #e74c3c; /* アクセントカラー */
        margin-top: 0;
        margin-bottom: 10px;
      }

      /* 説明文のスタイル (.store-description) */
      .store-description {
        line-height: 1.6; /* 行間を広げて読みやすく */
        margin: 0;
      }

      /* 読み込み中メッセージのスタイル */
      .loading-message {
        text-align: center;
        font-size: 1.2em;
        color: #7f8c8d;
        padding: 40px 0;
      }

      /* エラーメッセージのスタイル */
      .error-message {
        color: #c0392b;
        text-align: center;
        padding: 20px;
        background-color: #fadbd8;
        border-radius: 5px;
      }

      /* --- ログイン機能用の追加スタイル --- */

      /* ログイン画面のコンテナ */
      #login-container {
        text-align: center;
        padding: 50px 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-top: 50px;
      }

      /* メインコンテンツ（初期状態は非表示） */
      #main-content {
        display: none;
      }

      /* ログインボタン */
      #login-button {
        background-color: #4285f4;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      #login-button:hover {
        background-color: #357ae8;
      }

      /* ログアウトボタン */
      #logout-button {
        float: right;
        background-color: #95a5a6;
        color: white;
        border: none;
        padding: 5px 10px;
        font-size: 12px;
        border-radius: 3px;
        cursor: pointer;
        margin-bottom: 10px;
      }
      #logout-button:hover {
        background-color: #7f8c8d;
      }

      /* ユーザー情報表示 */
      #user-info {
        text-align: right;
        font-size: 0.9em;
        color: #666;
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <!-- 
     * HTMLセクション: ページの構造定義 
     -->

    <!-- ログイン画面エリア -->
    <div id="login-container">
      <h1>南陵祭 モバイルオーダー</h1>
      <p>利用するにはログインが必要です。</p>
      <button id="login-button">Googleでログイン</button>
    </div>

    <!-- メインコンテンツエリア（ログイン後に表示） -->
    <div id="main-content">
      <div id="user-info"></div>
      <button id="logout-button">ログアウト</button>

      <!-- ページ全体の大見出し -->
      <h1>南陵祭 モバイルオーダー</h1>

      <!-- 店舗一覧セクションの見出し -->
      <h2>出店一覧</h2>

      <!-- 
          JavaScriptが動的に店舗リストを挿入するための空のコンテナ要素 
        -->
      <div id="store-list"></div>
    </div>

    <!-- 
     * JavaScriptセクション: ロジックとFirebase連携
     -->

    <!-- 重要: Firebase SDKの読み込み (Compat版 v9) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <!-- 認証機能(Auth)のSDKを追加 -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script>
      // ▼▼▼▼ ここに自分のfirebaseConfigを貼り付ける ▼▼▼▼
      const firebaseConfig = {
        apiKey: "AIzaSyA-Ijkbo-9rgrNKbDlRJ-rQVYdSXR_a9Do",
        authDomain: "nanryosai-2026-a4091.firebaseapp.com",
        projectId: "nanryosai-2026-a4091",
        storageBucket: "nanryosai-2026-a4091.firebasestorage.app",
        messagingSenderId: "93228414556",
        appId: "1:93228414556:web:f64f90c13849fae9049899",
        measurementId: "G-1M5G95EXF0",
      };

      // Firebaseの初期化
      firebase.initializeApp(firebaseConfig);

      // FirestoreとAuthのインスタンスを取得
      const db = firebase.firestore();
      const auth = firebase.auth();

      // DOM要素の取得
      const loginContainer = document.getElementById("login-container");
      const mainContent = document.getElementById("main-content");
      const loginButton = document.getElementById("login-button");
      const logoutButton = document.getElementById("logout-button");
      const userInfoElement = document.getElementById("user-info");
      const storeListElement = document.getElementById("store-list");

      // ログインボタンのクリックイベント
      loginButton.addEventListener("click", () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch((error) => {
          console.error("Login failed:", error);
          alert("ログインに失敗しました: " + error.message);
        });
      });

      // ログアウトボタンのクリックイベント
      logoutButton.addEventListener("click", () => {
        auth
          .signOut()
          .then(() => {
            // ログアウト成功時の処理（画面はonAuthStateChangedで切り替わる）
            console.log("Signed out");
          })
          .catch((error) => {
            console.error("Sign out error", error);
          });
      });

      // 認証状態の監視
      // ページ読み込み時やログイン/ログアウト時に自動的に呼び出されます
      auth.onAuthStateChanged((user) => {
        if (user) {
          // --- ログイン状態 ---
          console.log("User is signed in:", user.email);

          // UIの切り替え
          loginContainer.style.display = "none";
          mainContent.style.display = "block";
          userInfoElement.textContent = `ログイン中: ${
            user.displayName || user.email
          }`;

          // 店舗データの取得を開始
          fetchStoreData();
        } else {
          // --- ログアウト状態 ---
          console.log("User is signed out");

          // UIの切り替え
          loginContainer.style.display = "block";
          mainContent.style.display = "none";
          storeListElement.innerHTML = ""; // リストをクリア
        }
      });

      // 店舗データを取得して表示する関数
      function fetchStoreData() {
        // 最初に「読み込み中...」を表示
        storeListElement.innerHTML =
          '<p class="loading-message">読み込み中...</p>';

        // Firestoreから "stores" コレクションの全ドキュメントを取得
        db.collection("stores")
          .get()
          .then((querySnapshot) => {
            // データ取得成功時の処理
            storeListElement.innerHTML = ""; // 「読み込み中」を消去

            if (querySnapshot.empty) {
              storeListElement.innerHTML =
                "<p>現在、登録されている店舗はありません。</p>";
              return;
            }

            querySnapshot.forEach((doc) => {
              const data = doc.data();
              const teamName = data.teamName ? data.teamName : "名称未設定";
              const description = data.description
                ? data.description
                : "説明はありません";

              const storeHtml = `
                            <div class="store-item">
                                <h3 class="store-name">${teamName}</h3>
                                <p class="store-description">${description}</p>
                            </div>
                        `;
              storeListElement.innerHTML += storeHtml;
            });
          })
          .catch((error) => {
            console.error("Error getting documents: ", error);
            storeListElement.innerHTML =
              '<p class="error-message">データの取得に失敗しました。<br>権限エラーの可能性があります。</p>';
          });
      }
    </script>
  </body>
</html>
