<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ステージ団体詳細 | 南陵祭'25</title>
    <style>
        /* CSSは変更なし (省略) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');:root{--header-height:80px;--primary-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--accent-gradient:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);--bg-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--sidenav-width:320px;--shadow-medium:0 15px 50px rgba(0,0,0,0.15);--shadow-strong:0 20px 60px rgba(0,0,0,0.2)}*{-ms-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body{background:var(--bg-gradient);color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;overflow-x:hidden;padding-top:var(--header-height);position:relative}body.sidenav-open{overflow:hidden}body::before{background:radial-gradient(circle at 20% 20%,rgba(255,255,255,0.1) 0%,transparent 40%),radial-gradient(circle at 80% 80%,rgba(255,255,255,0.1) 0%,transparent 40%);content:'';height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:-1}main{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;position:relative;z-index:2}.content-wrapper{margin:0 auto;max-width:960px;padding:40px 20px}.site-header{background:rgba(255,255,255,0.1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.2);-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;height:var(--header-height);left:0;padding:0 80px 0 30px;position:fixed;top:0;-webkit-transition:all .4s cubic-bezier(.23,1,.32,1);-o-transition:all .4s cubic-bezier(.23,1,.32,1);transition:all .4s cubic-bezier(.23,1,.32,1);width:100%;z-index:100}.site-header.hidden{-webkit-transform:translateY(-100%);-ms-transform:translateY(-100%);transform:translateY(-100%);opacity:0}.site-title a{-webkit-animation:float 6s ease-in-out infinite;animation:float 6s ease-in-out infinite;background:-webkit-gradient(linear,left top,right bottom,from(#fff),to(#e8f4f8));background:-o-linear-gradient(45deg,#fff,#e8f4f8);background:linear-gradient(45deg,#fff,#e8f4f8);background-clip:text;font-size:1.8em;font-weight:700;text-decoration:none;-webkit-transition:all .3s ease;-o-transition:all .3s ease;transition:all .3s ease;-webkit-text-fill-color:transparent;-webkit-background-clip:text}.desktop-nav{margin-left:auto}.desktop-nav ul{-ms-flex-pack:distribute;display:-webkit-box;display:-ms-flexbox;display:flex;gap:30px;list-style:none}.desktop-nav a{border-radius:25px;color:rgba(255,255,255,0.9);font-weight:500;padding:10px 20px;position:relative;text-decoration:none;-webkit-transition:all .3s ease;-o-transition:all .3s ease;transition:all .3s ease}.desktop-nav a::before{background:rgba(255,255,255,0.1);border-radius:25px;content:'';height:100%;left:0;opacity:0;position:absolute;top:0;-webkit-transition:opacity .3s ease;-o-transition:opacity .3s ease;transition:opacity .3s ease;width:100%}.desktop-nav a:hover{-webkit-transform:translateY(-2px);-ms-transform:translateY(-2px);transform:translateY(-2px);color:#fff}.desktop-nav a:hover::before{opacity:1}.hamburger-menu{-ms-flex-align:center;-ms-flex-direction:column;-ms-flex-pack:center;-webkit-box-align:center;-webkit-box-direction:normal;-webkit-box-pack:center;align-items:center;background:var(--accent-gradient);-webkit-box-shadow:var(--shadow-medium);box-shadow:var(--shadow-medium);border-radius:50%;cursor:pointer;display:-webkit-box;display:-ms-flexbox;display:flex;flex-direction:column;gap:4px;height:50px;justify-content:center;position:fixed;right:30px;top:20px;-webkit-transition:all .4s cubic-bezier(.23,1,.32,1);-o-transition:all .4s cubic-bezier(.23,1,.32,1);transition:all .4s cubic-bezier(.23,1,.32,1);width:50px;z-index:300}.hamburger-menu:hover{-webkit-transform:scale(1.1) rotate(5deg);-ms-transform:scale(1.1) rotate(5deg);transform:scale(1.1) rotate(5deg);-webkit-box-shadow:var(--shadow-strong);box-shadow:var(--shadow-strong)}.hamburger-menu .bar{background-color:#fff;border-radius:2px;height:2px;-webkit-transition:all .4s cubic-bezier(.23,1,.32,1);-o-transition:all .4s cubic-bezier(.23,1,.32,1);transition:all .4s cubic-bezier(.23,1,.32,1);width:22px}body.sidenav-open .hamburger-menu{background:#fff;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}body.sidenav-open .hamburger-menu .bar{background-color:#2c3e50}body.sidenav-open .hamburger-menu .bar1{-webkit-transform:translateY(6px) rotate(45deg);-ms-transform:translateY(6px) rotate(45deg);transform:translateY(6px) rotate(45deg)}body.sidenav-open .hamburger-menu .bar2{-webkit-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);opacity:0}body.sidenav-open .hamburger-menu .bar3{-webkit-transform:translateY(-6px) rotate(-45deg);-ms-transform:translateY(-6px) rotate(-45deg);transform:translateY(-6px) rotate(-45deg)}.sidenav{background:rgba(0,0,0,0.2);-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);border-left:1px solid rgba(255,255,255,0.2);height:100%;max-width:90vw;padding:100px 30px 30px;position:fixed;right:0;top:0;-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);-webkit-transition:-webkit-transform .5s cubic-bezier(.23,1,.32,1);-o-transition:transform .5s cubic-bezier(.23,1,.32,1);transition:transform .5s cubic-bezier(.23,1,.32,1);transition:transform .5s cubic-bezier(.23,1,.32,1),-webkit-transform .5s cubic-bezier(.23,1,.32,1);width:var(--sidenav-width);z-index:200}body.sidenav-open .sidenav{-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.sidenav ul{list-style:none}.sidenav li{margin-bottom:8px;opacity:0;-webkit-transform:translateX(30px);-ms-transform:translateX(30px);transform:translateX(30px);-webkit-transition:opacity .4s ease,-webkit-transform .4s ease;-o-transition:opacity .4s ease,transform .4s ease;transition:opacity .4s ease,transform .4s ease}body.sidenav-open .sidenav li{opacity:1;-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}body.sidenav-open .sidenav li:nth-child(1){-webkit-transition-delay:.1s;-o-transition-delay:.1s;transition-delay:.1s}body.sidenav-open .sidenav li:nth-child(2){-webkit-transition-delay:.15s;-o-transition-delay:.15s;transition-delay:.15s}body.sidenav-open .sidenav li:nth-child(3){-webkit-transition-delay:.2s;-o-transition-delay:.2s;transition-delay:.2s}body.sidenav-open .sidenav li:nth-child(4){-webkit-transition-delay:.25s;-o-transition-delay:.25s;transition-delay:.25s}body.sidenav-open .sidenav li:nth-child(5){-webkit-transition-delay:.3s;-o-transition-delay:.3s;transition-delay:.3s}body.sidenav-open .sidenav li:nth-child(6){-webkit-transition-delay:.35s;-o-transition-delay:.35s;transition-delay:.35s}body.sidenav-open .sidenav li:nth-child(7){-webkit-transition-delay:.4s;-o-transition-delay:.4s;transition-delay:.4s}.sidenav a{border-radius:15px;color:rgba(255,255,255,0.9);display:block;font-size:1.1em;font-weight:500;padding:18px 25px;text-decoration:none;-webkit-transition:all .3s cubic-bezier(.23,1,.32,1);-o-transition:all .3s cubic-bezier(.23,1,.32,1);transition:all .3s cubic-bezier(.23,1,.32,1)}.sidenav a:hover{background:rgba(255,255,255,0.1);-webkit-transform:translateX(10px);-ms-transform:translateX(10px);transform:translateX(10px);color:#fff}.sidenav .about-us{border-top:1px solid rgba(255,255,255,0.2);margin-top:40px;padding-top:30px}.sidenav .about-us a{color:rgba(255,255,255,0.6);font-size:1em}.page-overlay{background-color:transparent;height:100%;left:0;pointer-events:none;position:fixed;top:0;-webkit-transition:background-color .5s;-o-transition:background-color .5s;transition:background-color .5s;width:100%;z-index:150}body.sidenav-open .page-overlay{background-color:rgba(0,0,0,0.6);pointer-events:auto}.site-footer{background:rgba(0,0,0,0.2);color:rgba(255,255,255,0.8);font-size:.9em;padding:30px 20px;text-align:center}@-webkit-keyframes float{0%,100%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}}@keyframes float{0%,100%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(-10px);transform:translateY(-10px)}}@media (max-width:900px){.desktop-nav{display:none}.site-header{padding:0 80px 0 20px}.hamburger-menu{height:45px;right:20px;width:45px}}.header-bg{background-position:50%;background-size:cover;height:400px;left:0;position:absolute;top:0;width:100%;z-index:1}.header-bg::after{background:rgba(0,0,0,0.5);content:'';height:100%;left:0;position:absolute;top:0;width:100%}.page-title-section{-ms-flex-align:center;-webkit-box-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;min-height:400px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:relative;text-align:center;z-index:3}
        .page-title { font-size: 2.8em; font-weight: 700; line-height: 1.2; text-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .summary-section{ background:rgba(0,0,0,0.25); -webkit-backdrop-filter:blur(20px); backdrop-filter:blur(20px); border-radius:20px; display:flex; flex-wrap:wrap; gap:20px; margin-top:-80px; margin-bottom:40px; padding:30px; position:relative; z-index:4; }
        .summary-item{ flex-grow:1; min-width:200px; }
        .summary-item strong{ display:block; font-size:1.1em; margin-bottom:5px; opacity:0.9; }
        .summary-item span{ font-size:1.3em; font-weight:700; }
        .tabs{ border-bottom:2px solid rgba(255,255,255,0.2); display:flex; gap:30px; justify-content:center; margin-bottom:30px; }
        .tab-button{ background:transparent; border:none; border-bottom:3px solid transparent; color:#fff; cursor:pointer; font-size:1.2em; font-weight:600; opacity:0.7; padding:15px 0; transition:all .3s; }
        .tab-button.active{ border-bottom-color:#fff; opacity:1; }
        .tab-content{ display:none; padding:20px; background:rgba(0,0,0,0.15); border-radius:15px; animation:fadeIn .5s; }
        .tab-content.active{ display:block; }
        .timetable-table, .setlist-table { border-collapse: collapse; width: 100%; }
        .timetable-table td, .timetable-table th, .setlist-table td, .setlist-table th { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .timetable-table th, .setlist-table th { font-size: 1.1em; border-bottom: 2px solid rgba(255,255,255,0.3); }
        .timetable-table .time { font-weight: 700; white-space: nowrap; vertical-align: top; }
        .timetable-table .performance-desc { font-size: 0.9em; opacity: 0.8; padding-top: 5px; }
        .setlist { list-style: none; padding-left: 15px; margin-top: 8px; font-size: 0.9em; opacity: 0.9; }
        .setlist li { margin-bottom: 4px; }
        .setlist .song-title { font-weight: 600; }
        .setlist .song-artist { font-size: 0.9em; padding-left: 8px; color: rgba(255,255,255,0.8); }
        .setlist-empty { font-size: 0.9em; opacity: 0.8; margin-top: 8px; padding-left: 15px; }
        .timetable-section-header { background: rgba(255, 255, 255, 0.1); padding: 12px 15px; font-size: 1.3em; font-weight: 700; margin-top: 25px; border-radius: 10px; border-bottom: 2px solid rgba(255,255,255,0.2); }
        .timetable-section-header:first-child { margin-top: 0; }
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    </style>
</head>
<body>
    <header class="site-header"></header>
    <div class="hamburger-menu"> <span class="bar bar1"></span><span class="bar bar2"></span><span class="bar bar3"></span> </div> <div class="page-overlay"></div>
    <nav class="sidenav"></nav>
    
    <main>
        <div id="header-bg" class="header-bg"></div>
        <div class="page-title-section">
            <h1 id="group-name" class="page-title">読み込み中...</h1>
        </div>
        <div class="content-wrapper">
            <section id="summary-section" class="summary-section"></section>
            <section class="content-body">
                <div id="tabs" class="tabs"></div>
                <div id="tab-contents" class="tab-contents"></div>
            </section>
        </div>
    </main>
    <footer class="site-footer"></footer>
    
    <script defer src="data.js"></script>
    <script defer>
    document.addEventListener('DOMContentLoaded', async function() {
        // --- ▼▼▼ テンプレート共通処理 (フッターを更新) ▼▼▼ ---
        const body = document.body; const hamburger = document.querySelector('.hamburger-menu'); const overlay = document.querySelector('.page-overlay'); function toggleSidenav() { body.classList.toggle('sidenav-open'); } hamburger.addEventListener('click', toggleSidenav); overlay.addEventListener('click', toggleSidenav); let lastScrollTop = 0; const header = document.querySelector('.site-header'); if (header) { const headerHeight = header.offsetHeight; window.addEventListener('scroll', function() { let scrollTop = window.pageYOffset || document.documentElement.scrollTop; if (scrollTop > lastScrollTop && scrollTop > headerHeight) { header.classList.add('hidden'); } else { header.classList.remove('hidden'); } lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; }); }
        const siteHeader = document.querySelector('.site-header'); const siteFooter = document.querySelector('.site-footer'); const sidenav = document.querySelector('.sidenav'); if (siteHeader) { siteHeader.innerHTML = `<div class="site-title"><a href="index.htm">南陵祭'25</a></div> <nav class="desktop-nav"><ul><li><a href="about.htm">概要</a></li><li><a href="projects-list.htm">企画一覧</a></li><li><a href="stage-list.htm">ステージ発表</a></li><li><a href="map.htm">校内マップ</a></li><li><a href="access.htm">アクセス</a></li></ul></nav>`; } if (sidenav) { sidenav.innerHTML = `<ul><li><a href="about.htm">概要</a></li><li><a href="projects-list.htm">企画一覧</a></li><li><a href="stage-list.htm">ステージ発表</a></li><li><a href="map.htm">校内マップ</a></li><li><a href="access.htm">アクセス</a></li><li class="about-us"><a href="about-us.htm">About Us</a></li></ul>`; } 
        if (siteFooter) { siteFooter.innerHTML = `<p>&copy; 2025 横浜南陵高校 コンピューター科学部</p><p>記載されている情報は古い可能性があります。</p>`; }
        // --- ▲▲▲ テンプレート共通処理ここまで ▲▲▲ ---

        const urlParams = new URLSearchParams(window.location.search);
        const groupId = urlParams.get('group');
        
        let anotherSetlistData = {};
        try {
            const response = await fetch('another-setlist.json');
            if (response.ok) anotherSetlistData = await response.json();
        } catch (e) { console.info("another-setlist.json は見つかりませんでした。"); }

        const allPerformancesOfGroup = (typeof stageData !== 'undefined') ? stageData.filter(p => p.groupId === groupId) : [];

        if (allPerformancesOfGroup.length > 0) {
            const groupInfo = allPerformancesOfGroup[0];

            document.title = groupInfo.groupName + " | 南陵祭'25";
            document.getElementById('header-bg').style.backgroundImage = `url(${groupInfo.image || 'images/placeholder.jpg'})`;
            document.getElementById('group-name').innerText = groupInfo.groupName;

            let tabsHTML = `<button class="tab-button active" data-tab="info">団体紹介</button>`;
            let contentsHTML = `<div class="tab-content active" id="info"><p>${groupInfo.groupDescription || '詳細は当日をお楽しみに！'}</p></div>`;

            if (groupId === 'keion') {
                tabsHTML += `<button class="tab-button" data-tab="timetable">タイムテーブル</button>`;
                let timetableHTML = '';
                try {
                    const response = await fetch('keion_timetable.json');
                    const keionData = await response.json();
                    for (const sectionKey in keionData) {
                        const sectionBands = keionData[sectionKey];
                        let day = sectionKey.includes('Day1') ? 'DAY 1' : 'DAY 2';
                        let place = sectionKey.includes('Gym') ? '体育館ステージ' : '視聴覚室';
                        timetableHTML += `<div class="timetable-section-header">${day} - ${place}</div>`;
                        let performancesHTML = sectionBands.map(band => {
                            const bandName = band['バンド名(表示名)'] || band['バンド名(苗字)'];
                            const startTime = band['開始時間'].substring(0, 5);
                            const endTime = band['終了時間'].substring(0, 5);
                            const time = `${startTime} - ${endTime}`;
                            const songs = [];
                            if (band['曲1']) songs.push({ title: band['曲1'], artist: band['曲1アーティスト'] });
                            if (band['曲2']) songs.push({ title: band['曲2'], artist: band['曲2アーティスト'] });
                            let setlist = (songs.length > 0)
                                ? `<ul class="setlist">${songs.map(s => `<li><span class="song-title">${s.title}</span><span class="song-artist">${s.artist||''}</span></li>`).join('')}</ul>`
                                : `<div class="setlist-empty">セットリストは当日までお楽しみに！</div>`;
                            return `<tr><td class="time">${time}</td><td><strong>${bandName}</strong>${setlist}</td></tr>`;
                        }).join('');
                        timetableHTML += `<table class="timetable-table"><tbody>${performancesHTML}</tbody></table>`;
                    }
                } catch (e) { timetableHTML = '<p>情報の読み込みに失敗しました。</p>'; }
                contentsHTML += `<div class="tab-content" id="timetable">${timetableHTML}</div>`;

            } else if (anotherSetlistData[groupId]) {
                tabsHTML += `<button class="tab-button" data-tab="schedule">スケジュール</button>`;
                tabsHTML += `<button class="tab-button" data-tab="setlist">セットリスト</button>`;
                const scheduleHTML = allPerformancesOfGroup.map(p => `<tr><td>${p.tags.includes('DAY1')?'DAY 1':'DAY 2'}</td><td class="time">${p.time}</td><td><strong>${p.name}</strong></td></tr>`).join('');
                contentsHTML += `<div class="tab-content" id="schedule"><table class="timetable-table"><thead><tr><th>日程</th><th>時間</th><th>パフォーマンス</th></tr></thead><tbody>${scheduleHTML}</tbody></table></div>`;
                const setlist = anotherSetlistData[groupId];
                const setlistHTML = setlist.map(song => `<tr><td>${song.title}</td><td>${song.artist || ''}</td></tr>`).join('');
                contentsHTML += `<div class="tab-content" id="setlist"><table class="setlist-table"><thead><tr><th>曲名</th><th>アーティスト</th></tr></thead><tbody>${setlistHTML}</tbody></table></div>`;

            } else {
                tabsHTML += `<button class="tab-button" data-tab="schedule">スケジュール</button>`;
                const scheduleHTML = allPerformancesOfGroup.map(p => `<tr><td>${p.tags.includes('DAY1')?'DAY 1':'DAY 2'}</td><td class="time">${p.time}</td><td><strong>${p.name}</strong>${p.description?`<div class="performance-desc">${p.description}</div>`:''}</td></tr>`).join('');
                contentsHTML += `<div class="tab-content" id="schedule"><table class="timetable-table"><thead><tr><th>日程</th><th>時間</th><th>パフォーマンス</th></tr></thead><tbody>${scheduleHTML}</tbody></table></div>`;
            }

            // --- ★★★ タグの動的生成ロジック (ここにあります) ★★★ ---
            const summary = document.getElementById('summary-section');
            const places = [...new Set(allPerformancesOfGroup.map(p => p.place))].join(', ');
            const hasDay1 = allPerformancesOfGroup.some(p => p.tags.includes('DAY1'));
            const hasDay2 = allPerformancesOfGroup.some(p => p.tags.includes('DAY2'));
            let dayTag = '';
            if (hasDay1 && hasDay2) { dayTag = '両日'; } 
            else if (hasDay1) { dayTag = 'DAY 1'; } 
            else if (hasDay2) { dayTag = 'DAY 2'; }
            const otherTags = new Set();
            allPerformancesOfGroup.forEach(p => { p.tags.forEach(tag => { if (tag !== 'DAY1' && tag !== 'DAY2') { otherTags.add(tag); } }); });
            const allTagsString = [dayTag, ...otherTags].filter(Boolean).join(', ');
            summary.innerHTML = `<div class="summary-item"><strong>場所</strong><span>${places}</span></div><div class="summary-item"><strong>タグ</strong><span>${allTagsString}</span></div>`;
            
            document.getElementById('tabs').innerHTML = tabsHTML;
            document.getElementById('tab-contents').innerHTML = contentsHTML;

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    document.getElementById(e.currentTarget.dataset.tab).classList.add('active');
                });
            });

        } else {
            document.title = "エラー | 南陵祭'25"; 
            document.getElementById('group-name').innerText = '団体が見つかりません';
        }
    });
    </script>
</body>
</html>
